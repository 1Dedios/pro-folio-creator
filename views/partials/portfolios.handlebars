<section class="portfolios">
    <h2>Your portfolios</h2>

    {{#if portfolios.length}}
    <div class="grid">
        {{#each portfolios}}
        <article class="card portfolio-card" data-portfolio-id="{{this._id}}">
            <header>
                <h3>{{this.title}}</h3>
                {{#ifEquals this._id ../user.activePortfolioId}}
                <span class="badge active">Active</span>
                {{/ifEquals}}
            </header>

            <p class="desc">{{this.description}}</p>
            <p class="meta">Sections: {{this.sections.length}} â€¢ Last edited: {{formatDate this.updatedAt}}</p>

            <div class="card-actions portfolio-actions">
                <!-- Preview link separate from forms -->
                <a class="btn" href="/portfolio/{{this._id}}">Preview</a>

                <!-- Activate form (AJAX) -->
                <form method="post" action="/api/portfolios/{{this._id}}/activate" class="js-activate-form"
                    data-portfolio-id="{{this._id}}">
                    <input type="hidden" name="userId" value="{{../user._id}}">
                    {{#ifEquals this._id ../user.activePortfolioId}}
                    <!-- active -> show disabled Activated button (type=button to avoid accidental submit) -->
                    <button type="button" class="btn activated" disabled>Activated</button>
                    {{else}}
                    <!-- not active -> show Set active button that will submit AJAX -->
                    <button type="submit" class="btn js-set-active-btn">Set active</button>
                    {{/ifEquals}}
                </form>

                <!-- Delete form (AJAX) -->
                <form method="post" action="/api/portfolios/{{this._id}}/delete" class="js-delete-form"
                    data-portfolio-id="{{this._id}}">
                    <input type="hidden" name="userId" value="{{../user._id}}">
                    <button type="submit" class="btn btn-delete">Delete</button>
                </form>
            </div>
        </article>
        {{/each}}
    </div>
    {{else}}
    <div class="empty">You don't have any portfolios yet. <a href="/create">Create one</a>.</div>
    {{/if}}
</section>